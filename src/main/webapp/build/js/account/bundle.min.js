$.editable.addInputType("account",{element:function(a,b){"use strict";function c(a){var b=a.split("_"),c=b[0];return c}function d(a,b){var c;switch(b){case"text":c='<input id="'+a+'" type="text" min="1" max="50" size="15" class="required">';break;case"datetime-local":c='<input id="'+a+'" type="text" size="12" class="required">';break;default:throw new Error("Could not create control of type ["+b+"]")}return c}function e(a){var b,e=c(a);switch(e){case"firstName":case"lastName":case"email":b=d(a,"text");break;case"dateOfBirth":b=d(a,"datetime-local");break;default:throw new Error("No account property defined for ["+e+"]")}return $(b)}var f=b.getAttribute("id"),g=e(f);return $(this).append(g),g},plugin:function(a,b){"use strict";var c=b.getAttribute("id");0===c.indexOf("dateOfBirth",0)&&$("input",this).datetimepicker({format:"d/m/Y H:i",step:10})}});var form=form||{};!function(a){!function(a){"use-strict";var b={clearAddAccountForm:function(){$("#first-name").val(""),$("#last-name").val(""),$("#email").val(""),$("#date-of-birth").val("")}};$.extend(a,b)}("undefined"==typeof a?window:a)}(form);var accounts=accounts||{};!function(a){!function(a){"use strict";var b={addAccount:function(a){$.ajax({url:"/user-accounts/accounts",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({firstName:$("#first-name").val(),lastName:$("#last-name").val(),email:$("#email").val(),dateOfBirth:datetime.parse($("#date-of-birth").val())}),success:function(b){a.fnAddData([b.firstName,b.lastName,b.email,b.dateOfBirth,b.id]),form.clearAddAccountForm()},error:function(a,b){alert("Failed to add account.\nServer returned: "+a.statusText+"-"+a.responseText)}})},deleteAccount:function(a,b){var c=b.find("td a").attr("id");$.ajax({type:"DELETE",url:"/user-accounts/accounts/"+c,success:function(c){a.fnDeleteRow(b)},error:function(a,b){alert("Failed to delete account.\nServer returned: "+a.statusText+"-"+a.responseText)}})},init:function(a){$.ajax({url:"/user-accounts/accounts/",type:"GET",beforeSend:function(){$.blockUI({message:"<h1>Loading ...</h1>"})},success:function(b){b.length>0&&a.fnAddData(b)},error:function(a,b){alert("Failed to load user accounts.\nServer returned: "+a.statusText+"-"+a.responseText)}}).done(function(){$.unblockUI()})}};$.extend(a,b)}("undefined"==typeof a?window:a)}(accounts),$.fn.dataTableExt.oSort["date-bg-asc"]=function(a,b){"use strict";var c=datetime.toDate(a),d=datetime.toDate(b);return c>d?1:d>c?-1:0},$.fn.dataTableExt.oSort["date-bg-desc"]=function(a,b){"use strict";var c=datetime.toDate(a),d=datetime.toDate(b);return c>d?-1:d>c?1:0};var datetime=datetime||{};!function(a){!function(a){"use strict";var b={parse:function(a){function b(a){var b=parseInt(a,10);return--b}var c=a.split(" "),d=c[0],e=d.split("/"),f=e[0],g=e[1],h=e[2],i=c[1],j=i.split(":"),k=j[0],l=j[1],m=new Date(h,b(g),f,k,l);return m.getTime()},toDate:function(a){var b=this.parse(a),c=new Date(b);return c},toLocalDateTime:function(a){function b(a){return a>=0&&9>=a&&(a="0"+a),a}function c(a){return a>=0&&9>=a&&(a="0"+a),a}function d(a){return a>=1&&9>=a&&(a="0"+a),a}function e(a){return a>=1&&9>=a&&(a="0"+a),a}function f(a){var b=parseInt(a,10);return++b}var g=new Date(a),h=g.getDate(),i=g.getMonth(),j=g.getFullYear(),k=g.getHours(),l=g.getMinutes(),m=d(h)+"/"+e(f(i))+"/"+j+" "+c(k)+":"+b(l);return m}};$.extend(a,b)}("undefined"==typeof a?window:a)}(datetime),$(document).ready(function(){"use strict";var a=$("#accounts-table").dataTable({aaSorting:[[3,"asc"]],aoColumnDefs:[{aTargets:[3],mRender:function(a){return datetime.toLocalDateTime(a)},sType:"date-bg"},{aTargets:[4],bSortable:!1,mRender:function(a){return"<a href=accounts/"+a+" id="+a+">Delete account</a>"}}],fnHeaderCallback:function(a,b,c,d,e){a.getElementsByTagName("th")[0].innerHTML=d-c+" Accounts"},fnRowCallback:function(a,b,c,d,e){for(var f=$("td a",a).attr("id"),g=$("td",a),h=0;h<g.length;h++){var i=g[h];switch(h){case 0:i.setAttribute("id","firstName_"+f),i.setAttribute("class","edit");break;case 1:i.setAttribute("id","lastName_"+f),i.setAttribute("class","edit");break;case 2:i.setAttribute("id","email_"+f),i.setAttribute("class","edit");break;case 3:i.setAttribute("id","dateOfBirth_"+f),i.setAttribute("class","edit");break;case 4:i.setAttribute("class","delete");break;default:throw"Invalid column index ["+h+"]"}}},fnDrawCallback:function(){$("#accounts-table tbody tr td:not(.delete)").editable("/user-accounts/accounts/update",{type:"account",onblur:"submit",callback:function(b){function c(a){return 3===a?datetime.parse(b):b}var d=a.fnGetPosition(this),e=d[0],f=d[1],g=a.fnGetData(e);g[f]=c(f),a.fnUpdate(g,e)},onerror:function(a,b,c){alert("Failed to update account.\nServer returned "+c.status+": "+c.responseText),b.reset()}})}});accounts.init(a),a.delegate("tbody tr td a","click",function(b){if(b.preventDefault(),confirm("Are you sure you want to delete this account?")===!0){var c=$(this).parent().parent();accounts.deleteAccount(a,c)}}),$("#date-of-birth").datetimepicker({format:"d/m/Y H:i"}),$("#add-account-form").submit(function(b){b.preventDefault(),accounts.addAccount(a)})});